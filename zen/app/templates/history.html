{% extends "base.html" %}

{%- block title %}
<title>History</title>
{%- endblock title %}

{%- block body %}


<div class="container">

<nav aria-label="payroll navigation">
	<ul class="pagination">
		<li class="page-item">
			<a class="page-link" href="/{{username}}/history/{{ [0, curent_page-1] | max }}/{{entry_number}}">Previous</a>
		</li>
	{%- for page in range([page_number, 15] | min) %}
		<li class="page-item">
			<a class="page-link" href="/{{username}}/history/{{page}}/{{entry_number}}">{{ page+1 }}
			{%- if page == curent_page %}
				<span class="sr-only">(current)</span>
			{%- endif %}
			</a>
		</li>
	{%- endfor %}
		<li class="page-item">
			<a class="page-link" href="/{{username}}/history/{{ [curent_page+1, page_number-1] | min }}/{{entry_number}}">Next</a>
		</li>
	</ul>
</nav>
</div>

<div class="container">
<div class="accordion" id="payrollList">

{%- for item in selection %}
	{%- set name = "_"+item.replace(".", "").replace("-","") %}
	<div class="card">
		<div class="card-header" id="{{ name }}">
			<h5 class="mb-0">
			<button class="btn btn-link"
				type="button"
				data-toggle="collapse"
				data-target="#collapse{{ name }}"
				aria-expanded="{{ 'true' if loop.index == 1 else 'false' }}"
				aria-controls="collapse{{ name }}"
			>Payroll date : {{ data[item]["timestamp"] }}</button>
			</h5>
		</div>
		<div class="collapse {{ 'show' if loop.index == 1 else 'hide' }}"
			id="collapse{{ name }}"
			aria-labelledby="{{ name }}"
			data-parent="#payrollList"
		>
			<div class="card-body">
				<table class="table table-hover table-dark table-sm">
			{%- for (key,value) in data[item].items() if key not in ["weight", "timestamp", "delegate-share"] %}
				<tr><td>{{ key }}</td><td width="33%">{{ value }}</td></tr>
			{%- endfor %}
				</table>
				<button 
					type="button"
					class="btn btn-primary"
					data-toggle="modal"
					data-target="#details{{ name }}"
				>Details</button>
<!-- Modal -->
<div class="modal fade" id="details{{ name }}" tabindex="-1" role="dialog" aria-labelledby="modal{{ name }}" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="modal{{ name }}">Distribution details</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
<table class="table table-hover table-dark table-sm">
<thead>
	<tr>
		<th>Recipient Id</th>
		<th>Amount</th>
	</tr></thead>
<tbody>
{%- for reccord in details[item] %}
<tr>
	<td width="100%">{{ reccord["address"] }}</td>
	<td>{{ reccord["amount"] }}</td>
</tr>
{%- endfor %}
</tbody>
</table>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<!-- Modal -->
			</div>
		</div>
	</div>
{%- endfor %}
</div>
</div>
{%- endblock body %}
